<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±—â–µ—Å—Ç–≤–∞">
    <meta name="author" content="–õ—É—Ç–æ—à–∫–∏–Ω–∞ –í–∞–ª–µ—Ä–∏—è –í–∞—Å–∏–ª—å–µ–≤–Ω–∞">
    <title>{% block title %}–†–æ–ª—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±—â–µ—Å—Ç–≤–∞{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåê</text></svg>">
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
        <header class="header">
            <div class="header-content">
                <div class="breadcrumbs">
                    {% block breadcrumbs %}
                    <a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
                    {% endblock %}
                </div>
                <div class="additional-nav">
                    <a href="{{ url_for('index') }}#author">–û–± –∞–≤—Ç–æ—Ä–µ</a>
                    <a href="{{ url_for('index') }}#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
                    <button class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                        <span class="theme-icon">üåô</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- –õ–µ–≤–æ–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é -->
        <nav class="main-menu" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
            <div class="menu-header">
                <h2>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h2>
                <button class="menu-toggle" aria-label="–°–≤–µ—Ä–Ω—É—Ç—å –º–µ–Ω—é" aria-expanded="true">
                    <span class="toggle-icon">‚Üê</span>
                </button>
            </div>
            <ul>
                <li><a href="{{ url_for('index') }}" 
                       {% if request.endpoint == 'index' %}class="active" aria-current="page"{% endif %}
                       title="–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">
                       <span class="nav-icon">üè†</span>
                       <span class="nav-text">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</span>
                </a></li>
                <li><a href="{{ url_for('concept') }}" 
                       {% if request.endpoint == 'concept' %}class="active" aria-current="page"{% endif %}
                       title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –æ–±—â–µ—Å—Ç–≤–æ">
                       <span class="nav-icon">üåê</span>
                       <span class="nav-text">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –æ–±—â–µ—Å—Ç–≤–æ</span>
                </a></li>
                <li><a href="{{ url_for('structure') }}" 
                       {% if request.endpoint == 'structure' %}class="active" aria-current="page"{% endif %}
                       title="–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π">
                       <span class="nav-icon">üï∏Ô∏è</span>
                       <span class="nav-text">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π</span>
                </a></li>
                <li><a href="{{ url_for('functions') }}" 
                       {% if request.endpoint == 'functions' %}class="active" aria-current="page"{% endif %}
                       title="–§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π">
                       <span class="nav-icon">‚ö°</span>
                       <span class="nav-text">–§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π</span>
                </a></li>
                <li><a href="{{ url_for('trends') }}" 
                       {% if request.endpoint == 'trends' %}class="active" aria-current="page"{% endif %}
                       title="–¢—Ä–µ–Ω–¥—ã —Ä–∞–∑–≤–∏—Ç–∏—è">
                       <span class="nav-icon">üìà</span>
                       <span class="nav-text">–¢—Ä–µ–Ω–¥—ã —Ä–∞–∑–≤–∏—Ç–∏—è</span>
                </a></li>
                <li><a href="{{ url_for('problems') }}" 
                       {% if request.endpoint == 'problems' %}class="active" aria-current="page"{% endif %}
                       title="–ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–∏—Å–∫–∏">
                       <span class="nav-icon">‚ö†Ô∏è</span>
                       <span class="nav-text">–ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–∏—Å–∫–∏</span>
                </a></li>
                <li><a href="{{ url_for('sources') }}" 
                       {% if request.endpoint == 'sources' %}class="active" aria-current="page"{% endif %}
                       title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏">
                       <span class="nav-icon">üîç</span>
                       <span class="nav-text">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</span>
                </a></li>
            </ul>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="content" id="main-content">
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for message in messages %}
                            <div class="flash-message">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            
            {% block content %}{% endblock %}
            
            <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–≤–µ—Ä—Ö" -->
            <button class="back-to-top" aria-label="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã">
                ‚Üë –ù–∞–≤–µ—Ä—Ö
            </button>
        </main>

        <!-- –ü—Ä–∞–≤–æ–µ –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ -->
        <aside class="page-toc" aria-label="–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã">
            <div class="toc-header">
                <h3>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
                <button class="toc-toggle" aria-label="–°–≤–µ—Ä–Ω—É—Ç—å –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ" aria-expanded="true">
                    <span class="toggle-icon">‚Üë</span>
                </button>
            </div>
            <div class="toc-content">
                {% block toc %}
                <!-- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ–µ –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ -->
                {% endblock %}
            </div>
        </aside>

        <!-- –ü–æ–¥–≤–∞–ª —Å–∞–π—Ç–∞ -->
        <footer class="footer">
            <div class="footer-content">
                <p>&copy; –õ—É—Ç–æ—à–∫–∏–Ω–∞ –í–∞–ª–µ—Ä–∏—è –í–∞—Å–∏–ª—å–µ–≤–Ω–∞, 2025</p>
                <p>–ù–∞—É—á–Ω—ã–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å: –°.–õ. –ú–∏–Ω—å–∫–æ–≤, —Å—Ç. –Ω–∞—É—á. —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, –¥–æ—Ü–µ–Ω—Ç</p>
                <p>–ù–ò –¢–ì–£, –≥—Ä—É–ø–ø–∞ 122516</p>
                <div class="footer-links">
                    <a href="{{ url_for('sources') }}">–ò—Å—Ç–æ—á–Ω–∏–∫–∏</a>
                    <a href="{{ url_for('index') }}#author">–û–± –∞–≤—Ç–æ—Ä–µ</a>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è —è–∫–æ—Ä–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    e.preventDefault();
                    const headerHeight = document.querySelector('.header').offsetHeight;
                    const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - headerHeight;
                    
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    history.pushState(null, null, targetId);
                }
            });
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateActiveNav() {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.page-toc a');
            const headerHeight = document.querySelector('.header').offsetHeight;
            
            let currentSection = '';
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop - headerHeight - 20;
                const sectionHeight = section.clientHeight;
                if (window.pageYOffset >= sectionTop && 
                    window.pageYOffset < sectionTop + sectionHeight) {
                    currentSection = section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${currentSection}`) {
                    link.classList.add('active');
                }
            });
        }

        // –ö–Ω–æ–ø–∫–∞ "–ù–∞–≤–µ—Ä—Ö"
        const backToTopButton = document.querySelector('.back-to-top');
        
        function toggleBackToTop() {
            if (window.pageYOffset > 300) {
                backToTopButton.style.display = 'block';
            } else {
                backToTopButton.style.display = 'none';
            }
        }

        backToTopButton.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        const themeToggle = document.querySelector('.theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            const themeIcon = themeToggle.querySelector('.theme-icon');
            themeIcon.textContent = document.body.classList.contains('dark-theme') ? '‚òÄÔ∏è' : 'üåô';
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä —Ç–µ–º—ã
            localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
        });

        // –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –º–µ–Ω—é
        const menuToggle = document.querySelector('.menu-toggle');
        const mainMenu = document.querySelector('.main-menu');
        
        if (menuToggle && mainMenu) {
            menuToggle.addEventListener('click', () => {
                const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
                menuToggle.setAttribute('aria-expanded', !isExpanded);
                mainMenu.classList.toggle('collapsed');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É —Å—Ç—Ä–µ–ª–∫–∏
                const toggleIcon = menuToggle.querySelector('.toggle-icon');
                toggleIcon.textContent = isExpanded ? '‚Üí' : '‚Üê';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—é
                localStorage.setItem('menuCollapsed', !isExpanded);
            });
        }

        // –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è
        const tocToggle = document.querySelector('.toc-toggle');
        const pageToc = document.querySelector('.page-toc');
        
        if (tocToggle && pageToc) {
            tocToggle.addEventListener('click', () => {
                const isExpanded = tocToggle.getAttribute('aria-expanded') === 'true';
                tocToggle.setAttribute('aria-expanded', !isExpanded);
                pageToc.classList.toggle('collapsed');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è
                localStorage.setItem('tocCollapsed', !isExpanded);
            });
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
        function animateNumbers() {
            const numberElements = document.querySelectorAll('.stat-number');
            
            numberElements.forEach(element => {
                const target = parseFloat(element.getAttribute('data-target'));
                const duration = 2000;
                const step = target / (duration / 16);
                let current = 0;
                
                const timer = setInterval(() => {
                    current += step;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    element.textContent = current.toFixed(current % 1 !== 0 ? 1 : 0);
                }, 16);
            });
        }

        // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –≤ viewport
        function startAnimationWhenVisible() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        animateNumbers();
                        observer.unobserve(entry.target);
                    }
                });
            });
            
            const statsSection = document.querySelector('.research-stats');
            if (statsSection) {
                observer.observe(statsSection);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
        document.addEventListener('DOMContentLoaded', () => {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                themeToggle.querySelector('.theme-icon').textContent = '‚òÄÔ∏è';
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω—é
            const menuCollapsed = localStorage.getItem('menuCollapsed') === 'true';
            if (menuCollapsed && mainMenu && menuToggle) {
                menuToggle.setAttribute('aria-expanded', 'false');
                mainMenu.classList.add('collapsed');
                const toggleIcon = menuToggle.querySelector('.toggle-icon');
                toggleIcon.textContent = '‚Üí';
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è
            const tocCollapsed = localStorage.getItem('tocCollapsed') === 'true';
            if (tocCollapsed && pageToc && tocToggle) {
                tocToggle.setAttribute('aria-expanded', 'false');
                pageToc.classList.add('collapsed');
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            updateActiveNav();
            toggleBackToTop();
            startAnimationWhenVisible();
        });

        // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
        window.addEventListener('scroll', () => {
            updateActiveNav();
            toggleBackToTop();
        });

        window.addEventListener('resize', updateActiveNav);

        // –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            // Tab –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            if (e.key === 'Tab') {
                document.body.classList.add('keyboard-navigation');
            }
        });

        document.addEventListener('mousedown', () => {
            document.body.classList.remove('keyboard-navigation');
        });
    </script>
</body>
</html>